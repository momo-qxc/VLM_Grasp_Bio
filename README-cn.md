# VLM_Grasp_Bio

[English](README.md)

åŸºäºå¤šæ¨¡æ€è§†è§‰è¯­è¨€æ¨¡å‹ï¼ˆVLMï¼‰çš„æœºæ¢°è‡‚æŠ“å–ä¸æ”¾ç½®æ¼”ç¤ºå·¥ç¨‹ã€‚é¡¹ç›®åœ¨ MuJoCo ä¸­æ¨¡æ‹Ÿ UR5e æœºæ¢°è‡‚ï¼Œé€šè¿‡ **å…¨è‡ªç„¶è¯­è¨€æŒ‡ä»¤ + è§†è§‰åˆ†å‰² + ç‚¹äº‘æŠ“å–æ¨ç†** å®Œæˆç›®æ ‡ç‰©ä½“çš„æŠ“å–ä¸æ”¾ç½®ï¼›æ”¯æŒ **å•ç›¸æœº**ã€**åŒç›¸æœºç‚¹äº‘èåˆ** ä»¥åŠ **æ™ºèƒ½æ”¾ç½®** ä¸‰ç§æ¨¡å¼ï¼Œå®ç°ç«¯åˆ°ç«¯çš„è‡ªç„¶è¯­è¨€æ§åˆ¶ã€‚

## åŠŸèƒ½æ¦‚è§ˆ
- **å…¨è‡ªç„¶è¯­è¨€æ§åˆ¶**ï¼šæ”¯æŒå®Œæ•´çš„è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œå¦‚"æŠŠåŸ¹å…»çš¿æ”¾ç½®åˆ°æ˜¾å¾®é•œçš„å³è¾¹"ï¼Œå®ç°ç«¯åˆ°ç«¯çš„æŠ“å–ä¸æ”¾ç½®ã€‚
- **VLM ç›®æ ‡å®šä½**ï¼šè¾“å…¥è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼ŒVLM è¾“å‡ºç›®æ ‡ç‰©ä½“çš„ 2D è¾¹ç•Œæ¡†ã€‚
- **æ™ºèƒ½æ”¾ç½®æ£€æµ‹**ï¼šåŸºäºç©ºé—´æè¿°ï¼ŒVLM ä»å¤šç›¸æœºè§†è§’è¯†åˆ«æ”¾ç½®ä½ç½®ã€‚
- **æŠ“å–å§¿æ€æ¨ç†**ï¼šç»“åˆæ·±åº¦å›¾ä¸æ©ç ï¼Œåœ¨ GraspNet ä¸Šæ¨ç†æŠ“å–å§¿æ€ã€‚
- **åŒç›¸æœºç‚¹äº‘èåˆ**ï¼šæ¡Œé¢ç›¸æœº + è´§æ¶ç›¸æœºèåˆï¼Œæå‡é®æŒ¡åœºæ™¯çš„æŠ“å–æˆåŠŸç‡ã€‚
- **æŠ“å–æ‰§è¡Œä¸æ”¾ç½®**ï¼šå¸¦è‡ªåŠ¨è°ƒå¹³ä¸æ¥è¿‘è¡¥å¿çš„æŠ“å–æµç¨‹ï¼Œé¿å…å¤¹çˆªå€¾æ–œç¢°æ’ã€‚

## ä»£ç ç»“æ„
- `main_vlm.py`ï¼šä¸»å…¥å£ï¼Œäº¤äº’å¼é€‰æ‹©å•ç›¸æœº/åŒç›¸æœºèåˆæ¨¡å¼å¹¶æ‰§è¡ŒæŠ“å–ã€‚
- `vlm_process.py`ï¼šVLM åˆ†å‰²ä¸æŒ‡ä»¤è§£æï¼ˆQwen/Geminiï¼‰ã€‚
- `grasp_process_optimized.py`ï¼šæŠ“å–æ¨ç†ä¸æ‰§è¡Œï¼ˆå«è°ƒå¹³ä¸è¡¥å¿é€»è¾‘ï¼‰ã€‚
- `manipulator_grasp/`ï¼šUR5e æœºæ¢°è‡‚ä»¿çœŸç¯å¢ƒä¸è¿åŠ¨æ§åˆ¶ã€‚
- `graspnet-baseline/`ï¼šGraspNet æ¨ç†ä»£ç ä¸ä¾èµ–ã€‚

## å®‰è£…ä¸ç¯å¢ƒé…ç½®
> ä»¥ä¸‹æ­¥éª¤ä¸ºä¸€å¥—å¯ç”¨å‚è€ƒï¼Œè‹¥æœ¬æœºé©±åŠ¨/ç³»ç»Ÿä¸åŒï¼Œå¯æŒ‰éœ€è°ƒæ•´ç‰ˆæœ¬ã€‚

1) åˆ›å»ºç¯å¢ƒ
```bash
conda create -n vlm_graspnet python=3.11
conda activate vlm_graspnet
```

2) å®‰è£… GraspNet ç›¸å…³ä¾èµ–
```bash
cd graspnet-baseline
pip install -r requirements.txt
```

3) å®‰è£… PyTorchï¼ˆç¤ºä¾‹ï¼šCUDA 11.3ï¼‰
```bash
pip install torch==1.12.1+cu113 torchvision==0.13.1+cu113 torchaudio==0.12.1 --extra-index-url https://download.pytorch.org/whl/cu113
```

4) å®‰è£…æœºå™¨äººä¸ä»¿çœŸä¾èµ–
```bash
pip install spatialmath-python==1.1.14
pip install roboticstoolbox-python==1.1.1
pip install modern-robotics==1.1.1
pip install mujoco==3.3.1
```

5) ç¼–è¯‘ PointNet++ ä¸ k-NN ç®—å­
```bash
cd graspnet-baseline/pointnet2
python setup.py install
cd ../knn
python setup.py install
cd ../..
```

6) å®‰è£… GraspNet API
```bash
git clone https://github.com/graspnet/graspnetAPI.git
cd graspnetAPI
# å°† setup.py ä¸­çš„ sklearn æ›¿æ¢ä¸º scikit-learn
pip install .
cd ..
```

7) å…¶ä»–ä¾èµ–
```bash
pip install opencv-python
pip install --force-reinstall "numpy==1.26.4"
pip install ultralytics==8.3.98
pip install "opencv-python==4.5.5.64" --force-reinstall
pip install openai-whisper
pip install soundfile
pip install sounddevice
pip install pydub
pip install openai
pip install --upgrade transforms3d
```

8) å‡†å¤‡ GraspNet æƒé‡
å°† `checkpoint-rs.tar` æ”¾åˆ°ä»¥ä¸‹è·¯å¾„ï¼š
```
logs/log_rs/checkpoint-rs.tar
```

9) é…ç½® VLM Key
- Qwen/OpenAI å…¼å®¹æ¥å£ï¼šåœ¨ `vlm_process.py` ä¸­è®¾ç½® `api_key` ä¸ `base_url`ã€‚
- Geminiï¼šåœ¨ `vlm_process.py` ä¸­è®¾ç½® `genai.Client(api_key=...)`ã€‚

## è¿è¡Œæµç¨‹
```bash
python main_vlm.py
```
è¿è¡Œåå¯é€‰æ‹©æ¨¡å¼ï¼š
- `1`ï¼šå•ç›¸æœºï¼ˆæ¡Œé¢ç›¸æœº `cam`ï¼‰
- `2`ï¼šå•ç›¸æœºï¼ˆè´§æ¶ç›¸æœº `cam_shelf`ï¼‰
- `3`ï¼šåŒç›¸æœºç‚¹äº‘èåˆï¼ˆæ¨èç”¨äºé®æŒ¡åœºæ™¯ï¼‰
- `4`ï¼š**æ™ºèƒ½æ”¾ç½®æ¨¡å¼** ğŸ”¥ - å…¨è‡ªç„¶è¯­è¨€æ§åˆ¶æŠ“å–ä¸æ”¾ç½®

### æ¨¡å¼ 4ï¼šæ™ºèƒ½æ”¾ç½®
åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¾“å…¥å®Œæ•´çš„è‡ªç„¶è¯­è¨€æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š
- "æŠŠåŸ¹å…»çš¿æ”¾ç½®åˆ°æ˜¾å¾®é•œçš„å³è¾¹"
- "æŠŠè¯•ç®¡ç§»åˆ°æ¡Œå­å·¦ä¸Šè§’"
- "æŠ“å–çƒ§æ¯æ”¾åˆ°çº¢è‰²åŒºåŸŸ"

ç³»ç»Ÿå°†ï¼š
1. è§£ææŒ‡ä»¤ï¼Œæå–æŠ“å–ç›®æ ‡å’Œæ”¾ç½®ä½ç½®æè¿°
2. ä½¿ç”¨ VLM ä»æ¡Œé¢ç›¸æœºåˆ†å‰²ç›®æ ‡ç‰©ä½“
3. é€šè¿‡ GraspNet æ¨ç†æŠ“å–å§¿æ€
4. ä½¿ç”¨å¤šç›¸æœºè§†è§’ï¼ˆå…¨å±€ç›¸æœºï¼‰è¯†åˆ«æ”¾ç½®ä½ç½®
5. æ‰§è¡Œå®Œæ•´çš„æŠ“å–ä¸æ”¾ç½®ä»»åŠ¡

èåˆæ¨¡å¼ï¼ˆæ¨¡å¼ 3ï¼‰ä¸‹ä¼šæç¤ºè¾“å…¥ç›®æ ‡ç‰©ä½“çš„ **è‡ªç„¶è¯­è¨€æŒ‡ä»¤**ï¼Œéšåè¿›è¡Œ VLM åˆ†å‰²ä¸æŠ“å–æ¨ç†ã€‚

## æ¼”ç¤ºæ•ˆæœ

äº¤äº’ç•Œé¢ï¼ˆæ¨¡å¼é€‰æ‹©ï¼‰ï¼š

![äº¤äº’ç•Œé¢](Visual%20results/äº¤äº’ç•Œé¢.png)

äº¤äº’ç•Œé¢ï¼ˆæ™ºèƒ½æ”¾ç½®æ¨¡å¼ï¼‰ï¼š

![äº¤äº’ç•Œé¢2](Visual%20results/äº¤äº’ç•Œé¢2.png)

åŒç›¸æœºç‚¹äº‘èåˆæ•ˆæœï¼š

![èåˆç‚¹äº‘æ•ˆæœ](Visual%20results/èåˆç‚¹äº‘æ•ˆæœ.png)

æŠ“å–è¿‡ç¨‹ï¼š

![æŠ“å–ç‰©å“](Visual%20results/æŠ“å–ç‰©å“.png)

å‡†å¤‡æ”¾ç½®ï¼š

![å‡†å¤‡æ”¾ç½®](Visual%20results/å‡†å¤‡æ”¾ç½®.png)

æ”¾ç½®å®Œæˆï¼š

![æ”¾ç½®å®Œæˆ](Visual%20results/æ”¾ç½®å®Œæˆ.png)
è‡ªç„¶è¯­è¨€è¯†åˆ«ä½ç½®ï¼ˆè“è‰²ï¼šå‚ç…§ç‰©ï¼›çº¢è‰²ï¼šæ”¾ç½®ç‚¹ï¼‰ï¼š
![è‡ªç„¶è¯­è¨€è¯†åˆ«ä½ç½®](debug_place_position.jpg)

è§†é¢‘æ¼”ç¤ºï¼š

<video src="Visual%20results/video.mp4" controls></video>

## å‚è€ƒ
- ç¯å¢ƒé…ç½®å‚è€ƒï¼š`https://blog.csdn.net/agentssl/article/details/148089323`
